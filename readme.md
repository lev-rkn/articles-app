# Ads service

## Описание сервиса

Этот сервис, который предоставляет API для создания, хранения и выдачи объявлений.

### Используемые технологии

- GoLang - как основной язык программирования.
- PostgreSQL - БД для хранения объявлений.
- Swagger - документация API.
- Docker - контейнеризация проекта.

## Архитектура проекта

1. /cmd - тут находится точка входа в приложение.
2. /config - тут находятся статические файлы конфигурации.
3. /docs - тут лежит документация swagger.
4. /logger - тут лежат настроки логгера, используемого в проекте (slog).
5. /migrations - тут лежат миграции базы данных.
6. /internal - тут лежит внутренний код сервиса, который не может быть экспортирован в сторонние проекты.
    - /app - тут лежит инициализация всех модулей приложения и запуск сервера.
    - /config - тут лежит код конфиг-менеджера(koanf), он подтягивает статические файлы конфигов из /config (которая находится в корне проекта).
    - /controllers - тут лежит инициализация роутера сервиса, а также в этой папке представлен транспортный слой сервера. Тут происходит первичная обработка данных при поступлении запроса по http API.
    - /service - тут лежит внутренняя логика сервиса, которая не связана непосредственно ни с обработкой сетевых запросов, ни с взаимодействием с хранилищами данных.
    - /repository - тут лежит слой взаимодействия с базой данных.
    - /models - тут лежат модели различных сущностей в виде стрктур (в данном случае только сущность объявления).


## Запуск

Запускать проект необходимо с помощью docker-compose
 (Но конечно возможно и без него, но придется отдельно поднимать postgres).

```bash
docker-compose up
```

## API

http адрес сервера по умолчанию: localhost:8080

### Создание объявление

POST /ad/create/

Ждет на входе JSON с данными объявления. Пример json объекта:

```json
{
  "title": "title",
  "description": "description",
  "price": 1000,
  "photos": [
    "link1",
    "link2"
  ]
}
```

Валидация:

- Длина заголовка должна быть длиной от 1 до 200 символов.
- Длина описания Не должна быть более 1000 символов.
- Нельзя загрузить больше 3 ссылок на фотографии.

Создает в базе данных одно объявление.
Возвращает: ID объявления и код результата (ошибка или успех).

### Получение единичного объявления

GET /ad/{id}

Ждет указанный в URL адресе ID объявления.Возвращает: объект в формате JSON с данными объявления.

### Получение списка объявлений (постранично)

GET /ad/all/?page={pageNumber}

Ждет на входе URL параметры:

- page - Обязательный параметр, Обозначает номер страницы, каждая страница - 10 объявлений.
- price - Сортировка по цене (asc - по возрастанию, desc - по убыванию).
- date - Сортировка по дате создания (asc - по возрастанию, desc - по убыванию).

Пример запроса:

```bash
curl "http://localhost:8080/ad/all/?page=1&price=desc"
```

Возвращает: объект в формате JSON с данными вплоть до 10 объявлений.

## Тесты

Unit тесты написаны для всего слоя services и controllers.
Чтобы посмотреть покрытие проекта тестами, воспользуйтесь командой make:

```bash
make cover
```

## Документация Swagger

Чтобы посмотреть документацию Swagger, после запуска сервера перейдите по указанному адресу:
<http://localhost:8080/swagger/>

